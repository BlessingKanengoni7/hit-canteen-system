<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Login | HIT Canteen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Inter:wght@400;500&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Your original CSS -->
    <link rel="stylesheet" href="style.css">
</head>

<body>

<header class="header">
    <div class="logo-container">
        <h1>HARARE INSTITUTE OF TECHNOLOGY</h1>
        <span>Canteen Digital Ticketing System</span>
    </div>

    <div class="top-right">
        <a href="index.html" class="login-btn" style="width:auto;padding:0.5rem 1rem;">
            <i class="fas fa-home"></i> Home
        </a>
    </div>
</header>

<main class="auth-wrapper admin-auth-wrapper">

    <div class="auth-card">
        <h2><i class="fas fa-user-shield"></i> Administrator Login</h2>
        <p class="auth-subtitle">
            Authorized personnel only.
        </p>

        <form id="adminLoginForm" autocomplete="off">

            <div class="form-group">
                <label>Admin Username</label>
                <input
                    type="text"
                    id="adminUsername"
                    required
                    autocomplete="off"
                >
            </div>

            <div class="form-group">
                <label>Password</label>
                <input
                    type="password"
                    id="adminPassword"
                    required
                    autocomplete="off"
                >
            </div>

            <button type="submit" class="login-btn admin-btn">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>

        </form>
    </div>
</main>

<script>
window.onload = function () {
    document.querySelectorAll("input").forEach(input => input.value = "");
};

document.getElementById("adminLoginForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const username = document.getElementById("adminUsername").value.trim();
    const password = document.getElementById("adminPassword").value.trim();

    const btn = e.target.querySelector("button");
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Authenticating...';
    btn.disabled = true;

    try {
        const response = await fetch("http://localhost:5000/api/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password })
        });

        const data = await response.json();

        if (response.ok && data.success) {

            // Save token + role
            sessionStorage.setItem("ADMIN_TOKEN", data.token);
            sessionStorage.setItem("ADMIN_ROLE", data.role);

            if (data.role === "finance") {
                window.location.href = "finance-dashboard.html";
            } 
            else if (data.role === "canteen") {
                window.location.href = "canteen-dashboard.html";
            } 
            else {
                alert("Unknown role assigned.");
                btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
                btn.disabled = false;
            }

        } else {
            alert(data.message || "Login failed");
            btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
            btn.disabled = false;
        }

    } catch (error) {
        alert("Server error. Ensure backend is running.");
        btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
        btn.disabled = false;
    }
});
</script>

</body>
</html>
